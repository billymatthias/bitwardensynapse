{
	"name": "churn_rate",
	"properties": {
		"content": {
			"query": "WITH thirty_day_moving_cte ([date], trial_end_at, thirty_day_moving_trials, thirty_day_moving_conversions, thirty_day_moving_trials_enterprise, thirty_day_moving_trials_teams, thirty_day_moving_trials_families, thirty_day_moving_trials_other, thirty_day_moving_conversions_enterprise, thirty_day_moving_conversions_teams, thirty_day_moving_conversions_families, thirty_day_moving_conversions_other, conversions_total, conversions_enterprise, conversions_teams, conversions_families, conversions_other)\nAS\n(\n        SELECT\n        cal.[date] as [date]\n        ,et.trial_end_at\n        ,SUM(et.ended_trials_total) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_trials\n        ,SUM(c.conversions_total) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_conversions\n        ,SUM(et.ended_trials_enterprise) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_trials_enterprise\n        ,SUM(et.ended_trials_teams) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_trials_teams\n        ,SUM(et.ended_trials_families) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_trials_families\n        ,SUM(et.ended_trials_other) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_trials_other\n        ,SUM(c.conversions_enterprise) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_conversions_enterprise\n        ,SUM(c.conversions_teams) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_conversions_teams\n        ,SUM(c.conversions_families) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_conversions_families\n        ,SUM(c.conversions_other) OVER(ORDER BY [date] ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as thirty_day_moving_conversions_other\n        ,c.conversions_total\n        ,c.conversions_enterprise\n        ,c.conversions_teams\n        ,c.conversions_families\n        ,c.conversions_other\n    FROM dbo.calendar as cal\n    LEFT JOIN dbo.ended_trials as et ON cal.[date] = et.trial_end_at\n    INNER JOIN dbo.conversions as c\n    ON et.trial_end_at = c.trial_end_at\n    WHERE cal.[date] BETWEEN '2016-01-01' AND CONVERT (date, GETDATE())\n    --ORDER BY et.trial_end_at\n)\nSELECT\n    [date]\n    ,ROUND(CAST(thirty_day_moving_conversions as FLOAT) / NULLIF(thirty_day_moving_trials, 0), 2) as trial_conversion_rate\n    ,conversions_total\n    ,ROUND(CAST(thirty_day_moving_conversions_enterprise as FLOAT) / NULLIF(thirty_day_moving_trials_enterprise, 0), 2) as trial_conversion_rate_enterprise\n    ,conversions_enterprise\n    ,ROUND(CAST(thirty_day_moving_conversions_teams as FLOAT) / NULLIF(thirty_day_moving_trials_teams, 0), 2) as trial_conversion_rate_teams\n    ,conversions_teams\n    ,ROUND(CAST(thirty_day_moving_conversions_families as FLOAT) / NULLIF(thirty_day_moving_trials_families, 0), 2) as trial_conversion_rate_families\n    ,conversions_families\n    ,ROUND(CAST(thirty_day_moving_conversions_other as FLOAT) / NULLIF(thirty_day_moving_trials_other, 0), 2) as trial_conversion_rate_other\n    ,conversions_other\nFROM thirty_day_moving_cte as t\nORDER BY [date];",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"poolName": "SQLPOOL1",
				"databaseName": "SQLPOOL1"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}